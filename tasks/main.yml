---
# tasks file for server_setup

# ServerSetup uses git but doesn't install it
- name: Install git
  package:
    name: git

- name: Create the /opt/ServerSetup directory
  file:
    path: /opt/ServerSetup
    state: directory
    mode: 0755

- name: Download and untar the ServerSetup tarball
  # ansible-lint E208 gives an error if we don't specify the mode, but
  # we definitely don't want to do that here since it will override
  # the permissions on the files in the archive.
  unarchive: # noqa 208
    src: https://api.github.com/repos/noahpowers/ServerSetup/tarball/master
    dest: /opt/ServerSetup
    remote_src: yes
    extra_opts:
      - "--strip-components=1"

- name: Copy the PCA-specific ServerSetup script
  copy:
    src: pca_serversetup.sh
    dest: /opt/ServerSetup/serversetup.sh
    mode: 0755
  when: use_pca_script
